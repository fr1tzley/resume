<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Response Details</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/response.css') }}">
    <style>
        .bullet-list {
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }
        
        .bullet-list li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        
        .bullet-list li:before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.5rem;
            width: 0.75rem;
            height: 0.75rem;
            background-color: currentColor;
            border-radius: 50%;
        }
        
        /* Add a subtle hover effect */
        .bullet-list li:hover {
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="header-container" style="width: 100%"></div>

    <div class="page-header">
        <div class="page-title">Candidate Analysis Results</div>
    </div>

    <div class="container">
        <div class="conclusion-box">
            <div class="conclusion-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
                Overall Assessment
            </div>
            <div class="conclusion-value" id="conclusion_oneline">-</div>
        </div>

        <div class="metrics-grid">
            <div class="metric-box">
                <div class="metric-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    Satisfied Requirements
                </div>
                <div class="metric-value" id="satisfied_requirements_count">-</div>
            </div>
            <div class="metric-box">
                <div class="metric-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                    Unsatisfied Requirements
                </div>
                <div class="metric-value" id="unsatisfied_requirements_count">-</div>
            </div>
            <div class="metric-box">
                <div class="metric-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    Key Strengths
                </div>
                <div class="metric-value" id="strengths_count">-</div>
            </div>
            <div class="metric-box">
                <div class="metric-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    Areas of Improvement
                </div>
                <div class="metric-value" id="areas_of_improvement_count">-</div>
            </div>
        </div>

        <div class="response-container">
            <div class="section-heading">Detailed Analysis</div>
            
            <div class="response-field">
                <label for="overall_conclusion">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-right: 5px;"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
                    Overall Conclusion:
                </label>
                <textarea id="overall_conclusion" name="overall_conclusion" readonly></textarea>
            </div>
            
            <div class="response-field">
                <label for="satisfied_requirements">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-right: 5px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    Satisfied Requirements:
                </label>
                <textarea id="satisfied_requirements" name="satisfied_requirements" readonly></textarea>
            </div>
            
            <div class="response-field">
                <label for="unsatisfied_requirements">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-right: 5px;"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                    Unsatisfied Requirements:
                </label>
                <textarea id="unsatisfied_requirements" name="unsatisfied_requirements" readonly></textarea>
            </div>
            
            <div class="response-field">
                <label for="interview_fit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-right: 5px;"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Interview Fit:
                </label>
                <textarea id="interview_fit" name="interview_fit" readonly></textarea>
            </div>
            
            <div class="response-field">
                <label for="strengths">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-right: 5px;"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    Strengths:
                </label>
                <div id="strengths_container" class="bullet-list-container">
                    <ul id="strengths_list" class="bullet-list strengths"></ul>
                </div>
                <textarea id="strengths" name="strengths" readonly style="display: none;"></textarea>
            </div>
            
            <div class="response-field">
                <label for="areas_of_improvement">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-right: 5px;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    Areas of Improvement:
                </label>
                <div id="improvements_container" class="bullet-list-container">
                    <ul id="improvements_list" class="bullet-list improvements"></ul>
                </div>
                <textarea id="areas_of_improvement" name="areas_of_improvement" readonly style="display: none;"></textarea>
            </div>

            <div class="response-field" id="custom_questions_display" style="display: none;">
                <label for="custom_questions_and_answers" >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-right: 5px;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    Custom Questions:
                </label>
                <textarea id="custom_questions_and_answers" name="custom_questions_and_answers" readonly></textarea>
            </div>

        </div>

        <div class="nav-buttons">
            <button onclick="window.location.href='./records'" class="nav-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                Back to Records
            </button>
            <button onclick="window.print()" class="nav-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                Print Report
            </button>
        </div>
    </div>

    <script type="text/babel" src="{{ url_for('static', filename='js/header.js') }}"></script>

    <script type="text/babel">
         window.addEventListener('load', () => {
        if (ReactDOM && window.DashboardHeader) {
        const headerRoot = ReactDOM.createRoot(document.getElementById('header-container'));
        headerRoot.render(React.createElement(window.DashboardHeader));
        } else {
        console.error('React or DashboardHeader component not loaded properly');
        }
    });
    </script>

    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
    
            const paramsToInputs = {
                overall_conclusion: 'overall_conclusion',
                requirements_fit: 'requirements_fit',
                unsatisfied_requirements: "unsatisfied_requirements",
                satisfied_requirements: "satisfied_requirements",
                interview_fit: 'interview_fit',
                strengths: 'strengths',
                areas_of_improvement: 'areas_of_improvement',
                satisfied_requirements_count: 'satisfied_requirements_count',
                unsatisfied_requirements_count: 'unsatisfied_requirements_count',
                strengths_count: 'strengths_count',
                custom_questions_and_answers: 'custom_questions_and_answers',
                areas_of_improvement_count: 'areas_of_improvement_count',
                conclusion_oneline: "conclusion_oneline"
            };
    
            for (const [param, inputId] of Object.entries(paramsToInputs)) {
                try {
                    const element = document.getElementById(inputId);
                    const value = urlParams.get(param);
                    if (value !== null) {
                        if (inputId == "custom_questions_and_answers") {
                            document.getElementById("custom_questions_display").style = "display: block;";
                        }
                        
                        const decodedValue = decodeURIComponent(value.replace(/%(?![0-9][0-9a-fA-F]+)/g, '%25'));
                        
                        if (element.tagName && element.tagName === 'TEXTAREA') {
                            element.value = decodedValue;
                            // Auto-resize textarea
                            element.style.height = 'auto';
                            element.style.height = element.scrollHeight + 'px';
                            
                            // Special handling for strengths and areas of improvement
                            if (inputId === 'strengths') {
                                populateBulletList('strengths_list', decodedValue);
                            } else if (inputId === 'areas_of_improvement') {
                                populateBulletList('improvements_list', decodedValue);
                            }
                        } else {
                            element.textContent = decodedValue;
                        }
                    }
                } catch(error) {
                    console.log(error);
                    continue;
                }
            }
            
            // Function to populate bullet lists
            function populateBulletList(listId, textContent) {
                const list = document.getElementById(listId);
                if (!list) return;
                
                // Clear any existing content
                list.innerHTML = '';
                
                // Split by newlines and process each line that starts with '-'
                const lines = textContent.split('\n');
                
                lines.forEach(line => {
                    // Check if line starts with '-' and has content after it
                    if (line.trim().startsWith('-') && line.trim().length > 1) {
                        const listItem = document.createElement('li');
                        // Remove the leading '-' and trim whitespace
                        listItem.textContent = line.trim().substring(1).trim();
                        list.appendChild(listItem);
                    } else if (line.trim().length > 0) {
                        // For lines without '-' that have content, also add them
                        const listItem = document.createElement('li');
                        listItem.textContent = line.trim();
                        list.appendChild(listItem);
                    }
                });
                
                // If no bullet points were found, fallback to show the original textarea
                if (list.children.length === 0) {
                    const textareaId = listId === 'strengths_list' ? 'strengths' : 'areas_of_improvement';
                    document.getElementById(textareaId).style.display = 'block';
                    document.getElementById(listId).parentElement.style.display = 'none';
                }
            }
    
            // Add event listener to dynamically resize on input
            document.querySelectorAll('textarea:not([style*="display: none"])').forEach(textarea => {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = this.scrollHeight + 'px';
                });
                
                // Initialize heights
                textarea.style.height = 'auto';
                textarea.style.height = textarea.scrollHeight + 'px';
            });

            // Add color coding to metric values for better visualization
            const satisfiedCount = document.getElementById('satisfied_requirements_count');
            const unsatisfiedCount = document.getElementById('unsatisfied_requirements_count');
            
            if (satisfiedCount && satisfiedCount.textContent !== '-') {
                satisfiedCount.style.color = '#4285f4';  // Google blue
            }
            
            if (unsatisfiedCount && unsatisfiedCount.textContent !== '-') {
                unsatisfiedCount.style.color = '#ea4335';  // Google red
            }

            document.getElementById('strengths_count').style.color = '#34a853';  // Google green
            document.getElementById('areas_of_improvement_count').style.color = '#fbbc05';  // Google yellow
        };
    </script>
</body>
</html>